{# Navigation par mois - Composant reutilisable #}
{# Variables requises: routeName, dateReference, moisCourant, moisPrecedent, moisSuivant #}
{% set months = ['Janvier', 'Fevrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Aout', 'Septembre', 'Octobre', 'Novembre', 'Decembre'] %}
{% set currentYear = dateReference|date('Y')|number_format(0, '', '') %}
{% set currentMonth = dateReference|date('n') %}

<div class="bg-white rounded-lg shadow p-4 mb-4" x-data="{
    open: false,
    selectedYear: {{ currentYear }},
    baseUrl: '{{ path(routeName) }}'
}">
    <div class="flex items-center justify-between">
        <a href="{{ path(routeName, {mois: moisPrecedent}) }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors duration-150">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Mois precedent
        </a>

        <div class="text-center relative">
            <button @click="open = !open" type="button" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors duration-150">
                <h2 class="text-xl font-semibold text-gray-900">
                    {{ dateReference|date('F Y')|capitalize }}
                </h2>
                <svg class="w-5 h-5 text-gray-500 transition-transform" :class="open ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            {% if moisCourant != "now"|date('Y-m') %}
                <a href="{{ path(routeName) }}" class="text-sm text-blue-600 hover:underline">
                    Revenir au mois courant
                </a>
            {% endif %}

            {# Dropdown selecteur de mois #}
            <div x-show="open"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 transform scale-95"
                 x-transition:enter-end="opacity-100 transform scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 transform scale-100"
                 x-transition:leave-end="opacity-0 transform scale-95"
                 @click.away="open = false"
                 class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-50 w-72">

                {# Selecteur d'annee #}
                <div class="flex items-center justify-between mb-4">
                    <button @click="selectedYear--" type="button" class="p-1 hover:bg-gray-100 rounded">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <span class="text-lg font-semibold text-gray-900" x-text="selectedYear"></span>
                    <button @click="selectedYear++" type="button" class="p-1 hover:bg-gray-100 rounded">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>

                {# Grille des mois #}
                <div class="grid grid-cols-3 gap-2">
                    {% for i in 1..12 %}
                        <a :href="baseUrl + '?mois=' + selectedYear + '-' + '{{ '%02d'|format(i) }}'"
                           @click="open = false"
                           class="px-3 py-2 text-sm text-center rounded-lg transition-colors duration-150 {{ i == currentMonth ? 'bg-blue-600 text-white hover:bg-blue-700' : 'text-gray-700 hover:bg-gray-100' }}"
                           :class="selectedYear == {{ currentYear }} && {{ i }} == {{ currentMonth }} ? 'bg-blue-600 text-white hover:bg-blue-700' : 'text-gray-700 hover:bg-gray-100'">
                            {{ months[i-1]|slice(0, 4) }}
                        </a>
                    {% endfor %}
                </div>

                {# Raccourci mois courant #}
                <div class="mt-4 pt-3 border-t border-gray-200">
                    <a href="{{ path(routeName) }}" @click="open = false" class="block w-full text-center px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg">
                        Mois courant ({{ "now"|date('F Y')|capitalize }})
                    </a>
                </div>
            </div>
        </div>

        <a href="{{ path(routeName, {mois: moisSuivant}) }}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors duration-150">
            Mois suivant
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>
    </div>
</div>
